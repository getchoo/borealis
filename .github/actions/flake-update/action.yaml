name: "update flake inputs"
description: "wrapper around DeterminateSystems/update-flake-lock"
inputs:
  commit-msg:
    required: true
  github-token:
    description: "github read token for increasing rate limits"
    required: false
    default: ""
  inputs:
    description: "flake inputs to update"
    required: false
    default: ""
  update-token:
    description: "github write token for creating prs"
    required: true
runs:
  using: "composite"
  steps:
    - name: install nix
      uses: cachix/install-nix-action@v22
      with:
        github_access_token: ${{ inputs.github-token }}

    - name: run update-flake-lock
      uses: DeterminateSystems/update-flake-lock@v19
      id: update
      with:
        commit-msg: ${{ inputs.commit-msg }}
        inputs: ${{ inputs.inputs }}
        nix-options: "--accept-flake-config"
        pr-title: ${{ inputs.commit-msg }}
        token: ${{ inputs.update-token }}

    - name: auto-merge pull request
      shell: bash
      run: gh pr merge --auto --rebase "$PR_ID"
      env:
        GITHUB_TOKEN: ${{ inputs.update-token }}
        PR_ID: ${{ steps.update.outputs.pull-request-number }}
